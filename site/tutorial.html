<script src="lib/markdownit.js"></script>
<link rel="stylesheet" href="lib/bootstrap.css">
<link rel="stylesheet" href="lib/md.css">

<div class="row">
    <div class="col .no-gutters" style="max-width: 900px;">
        <div style="text-align: center; margin-left: 25px;">
            <select class="form-control" id="tutorial-select" onchange="setTutorial()"></select>
        </div>
        <br>
        <div id="t" class="t markdown-body"> Markdown Rendering Failed. </div>
        <br>
        <div style="text-align: center; margin-left: 25px;">
            <button class="btn btn-primary" style="width: 100%;" onclick="next()">Next Tutorial</button> <br> <br>
        </div>
    </div>
    <div class="col-auto .no-gutters">
        <div class="t" style="position: sticky; top: 20; max-width: 400px;">
            <div id="z" class="markdown-body">Markdown Rendering Failed.</div>
        </div>
    </div>
    
</div>

<style>
    body {
        background-color: #313131;
        overflow-x: hidden;
    }
    
    .im {
        max-height: 3rem;
        border: 1px solid black;
    }

    .t {
        margin-left: 25px;
        border: 2px solid #e1e4e8;
        border-radius: 6px;
        background-color: #fff;
        font-size: 14px;
        line-height: 1.5;
        color: #24292e;
        padding: 32px;
        max-width: 850px;
    }

    #email-form {
        border: 2px solid #e1e4e8;
        border-radius: 6px;
        padding: 16px;
    }

</style>

<script>
    function httpGet(url){
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", url, false); // synchronous
        xmlHttp.send();
        return {
            code: xmlHttp.status,
            text: xmlHttp.responseText
        }
    }

    var md = window.markdownit();
    document.getElementById("z").innerHTML = md.render(httpGet("desc.md").text);

    let i = location.hash.substring(1); // ie .../tutorial.html#4 -> 4
    if (i == "") i = 0;

    let t = (new Date()).getTime();
    let files = JSON.parse(httpGet("tutorial_list.json?" + t).text);
    let code = "";
    for (let i=0;i<files.length;i++){
        code += "<option value=" + i +" >" + files[i] + "</option>"
    }
    document.getElementById("tutorial-select").innerHTML = code;

    function loadText(){
        let name = files[i];
        let res = httpGet("tutorials/" + name + ".md");
        let result;
        if (res.code == 200){
            result = md.render(res.text);
        } else {
            result = md.render(httpGet("no_more.md").text);
        }
        document.getElementById("t").innerHTML = result;
    }
    loadText()
    document.getElementById("tutorial-select").value = i;

    function next(){
        i++;
        loadText();
        location.hash = i;
        document.getElementById("tutorial-select").value = i;
        window.scrollTo(0, 0);
    }
    function setTutorial(){
        i = document.getElementById("tutorial-select").value;
        loadText();
        location.hash = i;
    }
    
</script>
